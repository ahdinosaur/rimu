import Image from 'next/image'
import rimuTree from '../public/rimu-tree-768x1024.jpg'

# Rimu

<div align="center">
  <Image
    height={512}
    alt="An 800-year-old giant rimu tree stretching high into the canopy at ÅŒtari-Wilton's Bush in Te Whanganui-a-Tara (Wellington), Aotearoa (New Zealand)."
    src={rimuTree}
  />
</div>

<br />

<div align="center">
  <strong>
    Data structure template language.
  </strong>
</div>

Rimu is a template language for structured data and functional expressions.

Unlike other template languages, Rimu operates on data structures, not text.

## Features

- Structured: The good parts of [Yaml](https://en.wikipedia.org/wiki/YAML)
- Functional: The good parts of [Lisp](https://en.wikipedia.org/wiki/Lisp_(programming_language))
- Friendly: The good parts of [Logo](https://en.wikipedia.org/wiki/Logo_(programming_language))
- Lightweight embed: Able to be embedded into a web or native app
- Helpful to debug: Error messages let you know exactly what went wrong
- Safe with untrusted input: No arbitrary code execution or unbounded iterations

## Use cases

Rimu should be suitable for any situation where you want functional data or expressive configurations.

- Programmatic users: when you want to give users a friendly and expressive sandbox for making programmatic things, almost like [Scratch](https://scratch.mit.edu/) or [Logo](https://en.wikipedia.org/wiki/Logo_(programming_language)).
- Programmatic configuration: when your infrastructure-as-code ([Kubernetes](https://kubernetes.io/), [Terraform](https://www.terraform.io/), [NixOps](https://github.com/NixOS/nixops)), declarative package managers ([Nix](https://nixos.org/)), or build systems ([Bazel](https://bazel.build/)) are complex enough to need functional config generation.

The "programmatic user data" case is the motivating use case for the author ([Mikey](https://mikey.nz) at [Village Kit](https://villagekit.com)), so this may inform future developments. If Rimu doesn't meet your expectations, see [related projects](./related).

## Examples

###  Programmatic users

Have you ever heard of turtle geometry?

[![(1983) Talking Turtle (for PBS)](https://tube.arthack.nz/static/thumbnails/4aa0b733-971c-417e-8613-da86fb268e83.jpg)](https://tube.arthack.nz/videos/watch/d976a246-dd20-4441-82fe-d7c687a33a78)

> Watch on [tube.arthack.nz](https://tube.arthack.nz/videos/watch/96ffe315-5d1d-426f-8abe-93d8ad925dee) or [archive.org](https://archive.org/details/NOVATalkingTurtle/NOVA.S10E11.Talking.Turtle.1983.VHSRip.AAC2.0.x264-rattera.mp4)

We could implement a Logo-inspired turtle game using Rimu, where kids could move turtles with code.

If we wanted to [make a star](https://www.turtleacademy.com/programs/40499):

```yaml
- setwidth: 10
- setcolor: 4

- right: 18
- forward: 50

- $map: range(5)
  each:
    - right: 144
    - forward: 50
    - left: 72
    - forward: 50
```

Then the output is a list of commands for the turtle to execute.

Now we might start to think about a better data model, how do we want users to describe their turtle actions?

### Programmatic configuration

Now let's say we wanted to make a mini [Salt Stack](https://docs.saltproject.io/en/getstarted/), similar to [Comtrya](https://github.com/comtrya/comtrya).

Here's a (_contrived_) example,

A user's template (input):

```yaml
$let:
  pkgs:
    - "zsh"
    - "vim"
in:
  $map: pkgs
  item: pkg
  each:
    $switch:
      - case: os.name == "macos"
        then:
          $type: brew_install
          pkg: pkg
      - case: os.name == "linux" && os.distribution == "debian"
        then:
          $type: apt_install
          pkg: pkg
```

With an environment (context):

```yaml
os:
  name: "linux"
  distribution: "debian"
```

Becomes the output:

(Where this could be any output format: JSON, YAML, TOML, etc)

```yaml
- type: "apt_install"
  pkg: "zsh"
- type: "apt_install"
  pkg: "vim"
```
